#include "SampleFilter.h"

static double filter_taps[SAMPLEFILTER_TAP_NUM] = {
  -0.0057215623153963925,
  -0.0021984633242420853,
  -0.0026011292724684117,
  -0.003037195895299794,
  -0.0035054535646745003,
  -0.00400458218667375,
  -0.004532485524822347,
  -0.005086817633790197,
  -0.005664305691730033,
  -0.006261134426711782,
  -0.006873298219075668,
  -0.007495958411414193,
  -0.008123026389133977,
  -0.008749748399321067,
  -0.009367670351224431,
  -0.009972296206652215,
  -0.010554019871212619,
  -0.011105054115676187,
  -0.011617992374210372,
  -0.012082719978597818,
  -0.012490158968756462,
  -0.012831541995889803,
  -0.013097316948153753,
  -0.013277238867719513,
  -0.013361093201065504,
  -0.013339221824326786,
  -0.013202288518464502,
  -0.012939738650056137,
  -0.012543191589376142,
  -0.012003676839292078,
  -0.011312113481374802,
  -0.010461068384174908,
  -0.009442490561691054,
  -0.008251116600670799,
  -0.006881076564288794,
  -0.005326720903477831,
  -0.0035840323677897956,
  -0.001650942604391143,
  0.0004738989674416995,
  0.0027920945366772913,
  0.005303876985072039,
  0.008004972675206005,
  0.010892681220723245,
  0.0139661863469486,
  0.017213842703086377,
  0.020633367357825137,
  0.02421332533634291,
  0.02794513171613524,
  0.03181735715229476,
  0.035817557379616845,
  0.039932443285672026,
  0.044147281465188266,
  0.048446095883886646,
  0.052812429700435044,
  0.0572289310589656,
  0.061675768759979356,
  0.06614026938535696,
  0.0705865897324072,
  0.07501961036045578,
  0.07939785876119329,
  0.08370474077427514,
  0.08792670012219442,
  0.09204132619689406,
  0.09602472442119916,
  0.09985645822981842,
  0.1035192885965365,
  0.10699617472650452,
  0.11026875720304675,
  0.11331871225321272,
  0.11612972633090667,
  0.11868567482397828,
  0.12097452044110626,
  0.12298340878128992,
  0.12470248200525644,
  0.12612282391191798,
  0.12723537039184576,
  0.12803448268404358,
  0.12851587032063025,
  0.12867666640024572,
  0.12851587032063025,
  0.12803448268404358,
  0.12723537039184576,
  0.12612282391191798,
  0.12470248200525644,
  0.12298340878128992,
  0.12097452044110626,
  0.11868567482397828,
  0.11612972633090667,
  0.11331871225321272,
  0.11026875720304675,
  0.10699617472650452,
  0.1035192885965365,
  0.09985645822981842,
  0.09602472442119916,
  0.09204132619689406,
  0.08792670012219442,
  0.08370474077427514,
  0.07939785876119329,
  0.07501961036045578,
  0.0705865897324072,
  0.06614026938535696,
  0.061675768759979356,
  0.0572289310589656,
  0.052812429700435044,
  0.048446095883886646,
  0.044147281465188266,
  0.039932443285672026,
  0.035817557379616845,
  0.03181735715229476,
  0.02794513171613524,
  0.02421332533634291,
  0.020633367357825137,
  0.017213842703086377,
  0.0139661863469486,
  0.010892681220723245,
  0.008004972675206005,
  0.005303876985072039,
  0.0027920945366772913,
  0.0004738989674416995,
  -0.001650942604391143,
  -0.0035840323677897956,
  -0.005326720903477831,
  -0.006881076564288794,
  -0.008251116600670799,
  -0.009442490561691054,
  -0.010461068384174908,
  -0.011312113481374802,
  -0.012003676839292078,
  -0.012543191589376142,
  -0.012939738650056137,
  -0.013202288518464502,
  -0.013339221824326786,
  -0.013361093201065504,
  -0.013277238867719513,
  -0.013097316948153753,
  -0.012831541995889803,
  -0.012490158968756462,
  -0.012082719978597818,
  -0.011617992374210372,
  -0.011105054115676187,
  -0.010554019871212619,
  -0.009972296206652215,
  -0.009367670351224431,
  -0.008749748399321067,
  -0.008123026389133977,
  -0.007495958411414193,
  -0.006873298219075668,
  -0.006261134426711782,
  -0.005664305691730033,
  -0.005086817633790197,
  -0.004532485524822347,
  -0.00400458218667375,
  -0.0035054535646745003,
  -0.003037195895299794,
  -0.0026011292724684117,
  -0.0021984633242420853,
  -0.0057215623153963925
};

void SampleFilter_init(SampleFilter* f) {
  int i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void SampleFilter_put(SampleFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == SAMPLEFILTER_TAP_NUM)
    f->last_index = 0;
}

double SampleFilter_get(SampleFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < SAMPLEFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : SAMPLEFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
